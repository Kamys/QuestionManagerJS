<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Создание теста</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
          integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
            integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
            integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="style/main.css">
    <link rel="stylesheet" href="style/createTest.css">
    <script src="js/CreateQuestion.js"></script>
</head>
<body>
<div id="main-div">
    <div class="container">

        <div class="row">
            <div class="form-group">
                <label class="text-white">Название теста</label>
                <input type="text" class="form-control"
                       placeholder="Впишите название теста">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label class="text-white"> Количество баллов
                    <input type="number" class="form-control bfh-number col-4">
                </label>
                <small class="form-text text-white">Минимальное количество баллов, которое необходимо набрать
                    для прохождения теста
                </small>
            </div>
        </div>

        <div class="row">
            <div class="col-ms-12 col-ms-3 col-md-3">
                <div class="dropdown">
                    <button class="btn btn-default dropdown-toggle"
                            type="button"
                            id="dropdownMenu1"
                            data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="true">
                        Список вопросов
                    </button>
                    <div class="dropdown-menu scrollable-menu" id="list-question"
                         style="height: 300%; width: 300%; overflow-y: scroll;">
                    </div>
                </div>
            </div>

            <div class="col-ms-12 col-ms-6 col-md-9 col-lg-9">
                <div class="tab-content" id="nav-tabContent">
                    <div class="col-12">
                        <input type="text" id="question" style="white-space: normal;" class="form-control"
                               placeholder="Вопрос">
                    </div>
                    <div class="col-12">
                        <input type="text" id="answer" class="form-control"
                               placeholder="Ответ">
                    </div>
                    <div class="col-12">
                        <input type="number" id="point" placeholder="Баллы"
                               class="form-control bfh-number col-4">
                    </div>
                    <div class="col-12">
                        <button type="button" id="btnSaveQuestion" onclick="saveQuestion()" class="btn btn-primary"
                                style="white-space: normal;" disabled>Сохранить вопрос
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <div class="row" style="margin-top: 10px;">
            <button type="button" onclick="addQuestion()" class="btn btn-primary co-md-6 col-4"
                    style="margin-right: 10px; white-space: normal;">Добавить вопрос
            </button>
            <button type="button" onclick="deleteCurrentQuestion()" class="btn btn-danger co-md-6 col-4"
                    style="white-space: normal;">Удалить вопрос
            </button>
        </div>

        <div class="row" style="margin-top: 10px;">
            <button type="submit" onclick="saveTest()" class="btn btn-primary float-left col-4">Сохранить тест</button>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log("HELLO");
        updateList();
    });

    var listQuestion = $('#list-question');
    var currentItem;

    var dataQuestion = [
        {question: "В каком году родился Пушкин A. С. ?", answer: "1799", point: 11},
        {question: "5 + 5 = ?", answer: "10", point: 25},
        {question: "Столица Бельгии?", answer: "Брюссель", point: 5},
        {
            question: "Как называется группа файлов, которая хранится отдельной группой и имеет собственное имя?",
            answer: "Каталог",
            point: 4
        },
        {question: "Как называются данные или программа на магнитном диске?", answer: "Файл", point: 7},
        {

            question: "Какое наибольшее количество символов имеет имя файла или каталога в Windows?",
            answer: "255",
            point: 12
        },
        {question: "Какое наибольшее количество символов имеет расширение имени файла?", answer: "3", point: 16},
    ];

    $('#question').on('input', inputQuestion);
    $('#answer').on('input', inputQuestion);
    $('#point').on('input', inputQuestion);

    function saveTest() {
        var testJson = JSON.parse(JSON.stringify(dataQuestion));
        $.cookie("test-data", testJson);
    }

    function inputQuestion() {
        $('#btnSaveQuestion').prop('disabled', false);
    }

    function updateList() {
        listQuestion.empty();
        dataQuestion.forEach(function (question, index) {
            const tab = createTabQuestion(index, question.question);
            listQuestion.append(tab)
        });
        $(".list-group-item").click(itemClick);
    }

    function itemClick() {
        const index = $(this).attr('index');
        selectQuestion(index);
    }

    function selectQuestion(index) {
        currentItem = index;
        showQuestion(dataQuestion[index]);
    }

    function createTabQuestion(index, name) {
        name = name || "Имя вопроса";
        const tabQuestion = document.createElement('a');
        tabQuestion.className = "list-group-item list-group-item-action";
        tabQuestion.setAttribute('data-toggle', 'list');
        tabQuestion.setAttribute('role', 'tab');
        tabQuestion.setAttribute('index', index);
        tabQuestion.text = name;
        return tabQuestion;
    }

    function showQuestion(itemQuestion) {
        $('#question').val(itemQuestion.question);
        $('#answer').val(itemQuestion.answer);
        $('#point').val(itemQuestion.point);
    }

    function addQuestion() {
        dataQuestion.push({question: "Вопрос " + dataQuestion.length, answer: "", point: 0});
        updateList();
        selectQuestion(dataQuestion.length - 1);
    }

    function saveQuestion() {
        dataQuestion[currentItem].question = $('#question').val();
        dataQuestion[currentItem].answer = $('#answer').val();
        dataQuestion[currentItem].point = $('#point').val();
        updateList();
        $('#btnSaveQuestion').prop('disabled', true);
    }

    function deleteCurrentQuestion() {
        delete dataQuestion[currentItem];
        updateList();
        $('#question').val('');
        $('#answer').val('');
        $('#point').val('');
    }
</script>
</body>
</html>